# .github/workflows/mirror.yml

name: Mirror to Repository A

on:
  push:
    branches:
      - '**'  # 모든 브랜치가 푸시될 때
    tags:
      - '**'  # 모든 태그가 푸시될 때

jobs:
  mirror-to-a:
    runs-on: ubuntu-latest
    steps:
      # 1. B 리포지토리(원본)의 모든 내용을 체크아웃합니다.
      - name: Checkout B Repository (Source)
        uses: actions/checkout@v4
        with:
          lfs: true        # LFS 파일도 포함 (필요한 경우)
          fetch-depth: 0   # 모든 히스토리와 태그를 가져옴 (미러링에 필수)

      # 2. 모든 브랜치 정보를 확실하게 가져옵니다.
      - name: Fetch all branches from origin (B)
        run: git fetch origin --prune

      # 3. A 리포지토리(대상)를 'push' 대상으로 설정합니다.
      - name: Set up push remote (A Repository)
        env:
          # 2단계에서 B 리포지토리 Secret에 저장한 토큰
          GITHUB_TOKEN: ${{ secrets.MIRROR_TOKEN }}
          # A 리포지토리의 URL
          TARGET_REPO_URL: "https://github.com/HBNU-SWUNIV/come-capstone25-overclocked_quartet.git"
        run: |
          # 토큰을 사용하여 A 리포지토리의 URL을 설정합니다.
          git remote set-url --push origin "https://x-access-token:${GITHUB_TOKEN}@${TARGET_REPO_URL#https://}"
          
      # 4. A 리포지토리로 미러 푸시(덮어쓰기)를 실행합니다.
      - name: Push all branches and tags to A (Mirror)
        run: git push --mirror
        

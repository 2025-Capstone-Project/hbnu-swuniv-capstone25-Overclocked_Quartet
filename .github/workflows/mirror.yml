# .github/workflows/mirror.yml

name: Mirror to Repository A

on:
  push:
    branches:
      - '**'  # 모든 브랜치가 푸시될 때
    tags:
      - '**'  # 모든 태그가 푸시될 때

jobs:
  mirror-to-a:
    if: github.repository != 'HBNU-SWUNIV/come-capstone25-overclocked_quartet'
    runs-on: ubuntu-latest
    steps:
      # 1. B 리포지토리(원본)의 모든 내용을 체크아웃합니다.
      - name: Checkout B Repository (Source)
        uses: actions/checkout@v4
        with:
          lfs: true
          fetch-depth: 0   # 모든 히스토리와 태그를 가져옴
          persist-credentials: false

      # 2. 모든 브랜치 정보를 확실하게 가져옵니다.
      - name: Fetch all branches from origin (B)
        run: git fetch origin --prune

      # 3. A 리포지토리(대상)로 미러 푸시(덮어쓰기)를 실행합니다.
      - name: Push all branches and tags to A (Mirror)
        env:
          # A 리포지토리 URL
          TARGET_REPO_URL: "https://github.com/HBNU-SWUNIV/come-capstone25-overclocked_quartet.git"
        run: |
          # 2단계에서 B 리포지토리 Secret에 저장한 토큰을 사용하여 URL을 설정하고 푸시합니다.
          git remote set-url --push origin "https://x-access-token:${{ secrets.MIRROR_TOKEN }}@${TARGET_REPO_URL#https://}"
          git push --mirror
